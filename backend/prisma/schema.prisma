generator client {
   provider = "prisma-client-js"
}

datasource db {
   provider = "postgresql"
   url      = env("DATABASE_URL")
}

// Auth
model User {
   id              String    @id
   email           String    @unique
   username        String    @unique
   name            String
   hashedPassword  String
   avatarUrl       String?
   sessions        Session[]
   messages        Message[]
   suggestedTopics Topic[]   @relation("suggestedTopics")
   votedTopics     Topic[]
}

model Session {
   id        String   @id
   userId    String
   expiresAt DateTime
   user      User     @relation(references: [id], fields: [userId], onDelete: Cascade)
}

// Chat
model Message {
   id        String   @id @default(uuid())
   postedAt  DateTime @default(now())
   updatedAt DateTime @updatedAt
   content   String   @db.VarChar(500)
   user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
   userId    String
}

// Topic voting
model Topic {
   id          String   @id @default(uuid())
   suggestedAt DateTime @default(now())
   content     String   @db.VarChar(100)
   votes       Int      @default(1)
   author      User     @relation("suggestedTopics", fields: [authorId], references: [id], onDelete: Cascade)
   authorId    String
   voters      User[]
}

// Key-Value store
model KeyValue {
   key       String   @id
   value     Json
   updatedAt DateTime @updatedAt
}
